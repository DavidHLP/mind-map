# JDK1.8 HashMap 改动

## 哈希函数优化

- JDK1.7
  - 实现：
    ```java
    static int hash(int h) {
        h ^= (h >>> 20) ^ (h >>> 12);
        return h ^ (h >>> 7) ^ (h >>> 4);
    }
    ```
  - 特点：多次异或，哈希值分布一般
- JDK1.8
  - 实现：
    ```java
    static final int hash(Object key) {
        int h;
        return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
    }
    ```
  - 优化点：
    - 高 16 位与低 16 位异或
    - 哈希分布更均匀，减少冲突
    - 速度更快、实用性更高

## 扩容机制优化

- JDK1.8 改进：
  - 扩容时不再重新取模计算索引
  - 根据原数组长度的高位判断元素留在原位置还是迁移到新位置
  - 优点：减少计算，提升扩容效率

## 链表插入方式

- JDK1.7：头插法
  - 优点：插入快，不用遍历链表
  - 缺点：
    - 扩容时链表逆序
    - 多线程操作下可能形成环，导致死循环
- JDK1.8：尾插法
  - 每次从尾部插入
  - 扩容后链表顺序保持一致
  - 优点：避免多线程扩容时形成环
