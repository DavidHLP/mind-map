---
markmap:
  colorFreezeLevel: 2
---

# HashMap 为什么容量是 2 的 n 次方

## 回答重点

- HashMap 采用 2 的 n 次方倍作为容量
  - 提高哈希值分布均匀性
  - 提高哈希计算效率
- 索引计算方式：`(n - 1) & hash`
  - 只有当数组容量是 2 的 n 次方时才能保证均匀分布
  - **位运算效率 > 取模运算（`hash % n`）**
- 扩容机制：
  - 容量为 2 的 n 次方时，扩容只需简单位运算判断是否迁移
  - 减少重新计算索引的开销
  - 提升 rehash 效率

## 扩展知识

### 哈希分布均匀性

- 当数组容量为 2 的 n 次方时：
  - `n - 1` 的低位都是 1
  - `hash & (n - 1)` 可以充分利用哈希码低位的随机性
- 示例：
  - `64 = 0100 0000`
  - `64 - 1 = 0011 1111`
  - `0011 1111 & hash` → 低位均匀分布
  - 若用 `0100 0000 & hash` → 低位全 0，冲突严重

### 位运算与取模

- 常规索引计算：`hash % n`
- 问题：取余效率较低
- 优化方式：使用位运算
  - 当 `n = 2^k` 时：
    - `a % n == a & (n - 1)`
  - 位运算更快 → 适合 HashMap
